---
title: 自动重启/开机自启
---

# 为服务器配置自动重启/开机自启

<details>
  <summary>为什么配置自动重启/开机自启？</summary>

想象一下，你在一个云服务器上开了一个普通的mc服务器，每天都有源源不断的玩家上线游戏。  
有一次，你忙着为期中考试做准备，连续4天没有上线，忘掉了服务器这边的情况。等你上线时，发现307人的服务器群竟然只剩下272人。  
你的心凉了半截，连忙翻看聊天记录看看服务器群里发生了什么。原来，在你离开 QQ 专心为考试做准备的那天下午，服务器突然离线，玩家们都无法进入服务器。  
玩家们纷纷在群里报怨，有的还来私信你反应情况。可是你正在复习，QQ 消息早已屏蔽，对这一切浑然不知。  
到了晚上，玩家们怨声载道，有的人在群里发各种逆天抽象，有的人则是在猜测你遇到了什么事。新加入的玩家看到服务器已经离线一下午，纷纷离开去寻找更好的服务器。  
第二天白天，服务器群里一片安静，只有几位老玩家讨论了几句服务器什么时候恢复的话题。到了晚上，突然有人说，该不会是服主跑路了吧。  
此言一出，玩家们纷纷认同，并且根据你公开的运维记录和聊天记录，猜测出了各种你跑路的原因。随后，有几位刚加入但没玩几天的玩家退了群。  
第三天开始到现在，服务器群已经变成了聊天群，没人再讨论游戏相关内容，退群的玩家也越来越多。    
可是为什么服务器会离线？你急切地想找出原因。你来到服务商官网，很快明白了事情的原委：在你离开后不久，机房发出了维护公告，称当天下午将进行为期半小时的维护，期间服务器将被关机，维护结束后自动开启。  
你对了下时间，维护仅进行了12分钟，随后服务器便自动开启。然而服务器程序需要你手动进行开启，于是服务器操作系统虽然被启动了，但是玩家仍然无法进入服务器，服务器操作系统就这样空转了4天……  
你无比地痛恨运营商，恨他们为什么不早点通知你，你也无比地自责，后悔为什么自己不早点为服务端核心设置开机自启。  
在这一瞬间，你对那些电脑上烦人的开机自启软件的痛恨似乎短暂地消失了，你突然感觉开机自启有时并不是一件坏事，当你不能日夜守在服务器前时，开机自启就是你最强大的救星。  
于是你打开了这篇教程，发誓自己一定要马上学会为服务器配置开机自启，不能让这样的事情再次发生。  

再想象一下，你是一位资金充足的计算机爱好者，用自己的闲置电脑和自己幸运“抽中”的家宽公网IPv4搭建了一台mc服务器。  
在你的精心照料下，服务器蒸蒸日上，服务器越来越火爆，也有不少爱好技术的玩家转变为管理员，与你日夜不停地为服务器挥洒着汗水。  
好不容易请了今年的年假，你们一家三口踏上了为期7天的度假之旅。临走前站在家门口，你看着你的服务器在角落里嗡嗡地运转着，心里暗自祈祷服务器不要出现问题。  
第三天，你们一家三口正在景点愉快地合照，突然 QQ 不断地传出新消息的声音。你拿出手机一看，玩家们纷纷反映服务器连不上了。你心里咯噔一下，赶快连接服务器远程桌面，看看服务器发生了什么。  
结果远程桌面根本无法连接，管理员们也表示服务器对包括ping在内的任何请求都无响应。包括是服务端、机器人、网页控制台、远程桌面等任何一个服务都不在线，情况不能再坏了。  
现在你已经没有任何办法操作服务器，你想赶快回家看看服务器，可是你现在离家500公里，这根本不现实。你开始根据情况猜测服务器的故障原因。  
崩溃？不一定，即使是蓝屏，电脑也会自动重启，不会一直离线。宽带欠费？你看了下运营商的手机营业厅，话费余额还剩200多块，根本不可能欠费。  
被网络攻击？这倒有可能，但是你也没招谁惹谁，不过万一是真的有人来报复或者单纯是心情不好用你发泄？或者……家里宽带的上游网关出了故障？只能再等一等了。  
煎熬地过了几个小时，服务器问题依旧。攻击也攻击不了这么长时间，修网关也不会修这么长时间。难道是服务器哪里坏掉了？或者是服务器的远程桌面被暴破，变成了别人的地盘？再或者……只是简单的跳闸？无论是哪种原因，你都得回家才能确认是什么问题。  
就这样，你在焦虑中度过了剩下的四天，终于回到了家。厨房的冰箱仍然在正常运转，显然并不是跳闸的缘故。你转向服务器，服务器并没有运行，而是关机状态。  
你按下电源开关，风扇转了起来，你登上服务器后台，启动各个服务，它们全部运转正常，没有任何故障。  
到底是什么导致了服务器自动关机？你仔细回想自己临走前对服务器进行的操作，似乎没有任何一个操作会导致服务器自动关机。  
坏了，要是这样，那服务器将来又出现这种莫名其妙的故障怎么办？这样，你会永远地活在不安之中。  
直到你在微信里找到了物业群里面邻居们的报怨：你走后的第三天，小区突然停电，原来是那天中午下了暴雨，积水泡坏了一处供电线。好在电业局的人紧急抢修，只过了不到半小时，供电就恢复了。  
可是你的服务器并没有人来为它按下开机键，它就这样在关机的状态下放了四天。  
你无比地自责，于是你打开了这篇教程，发誓自己一定要马上学会为服务器配置开机自启，不能让这样的事情再次发生。

在我们的日常生活中，经常会碰到诸如电线维修或损坏，或服务商对机房维护而重启你的服务器的不可抗力因素。既然你不能日夜守在服务器前，你就应该为这些情况做好准备，让服务器符合运行条件时立即恢复，而不是需要你去手动按下开机键。

</details>

## 自动重启

### Windows 使用批处理文件（.bat）

如果你的服务器没有使用批处理文件启动，你需要将其修改为使用批处理文件启动。在服务器可执行文件同级目录新建一个记事本（.txt）文件，编辑其内容为`./服务器可执行文件的文件`或启动命令（如`java -jar server.jar`）。

为了让你的服务器能够在关闭后自行开启，你需要将启动脚本修改为如下格式：

```powershell
:start
原先的启动命令
goto start
```

例如：

```powershell
@ECHO OFF
:start
java ..... -jar 核心名.jar --nogui
goto start
```

以上代码中的start字段可以被替换为其他任何连续的、以英文开头的英文和数字组合，但是需要保持上下两个字段一致。

此外，**此方法启动的服务器会在手动地正常关闭后再次开启**，也就是**无法正常关闭**，只能通过手动点击控制台窗口的关闭按钮或使用`Ctrl+C`来关闭。如果你需要灵活地自动重启服务器，例如仅在服务器崩溃后重启，请参考下文中使用面板自动重启服务器的方法。

### Linux 使用 Shell 脚本

如果你的服务器没有使用 Shell 脚本文件启动，你需要将其修改为使用批处理文件启动。在服务器可执行文件同级目录新建一个 .sh 文件，编辑其内容为`./服务器可执行文件的文件`或启动命令（如`java -jar server.jar`）。

为了让你的服务器能够在关闭后自行开启，你需要将启动脚本修改为如下格式：

```bash
while [ true ]; do
    原先的启动命令
done
```

例如：

```bash
while [ true ]; do
    java ..... -jar 核心名.jar --nogui
    echo 服务器自动重启中
    echo 同时按下 CTRL + C 关服.
done
```

**此方法启动的服务器会在手动地正常关闭后再次开启**，也就是**无法正常关闭**，只能通过`Ctrl+C`来关闭。如果你需要灵活地自动重启服务器，例如仅在服务器崩溃后重启，请参考下文中使用面板自动重启服务器的方法。

### 使用面板

大多数成熟的面板都带有完善的自动重启功能，它们默认只会在服务器异常崩溃时尝试重启服务器。对于服务器被人为关闭、被其加载的插件执行关闭后的关闭，面板不会进行重启操作，这让服务器维护变得十分方便和可靠。

关于如何在服务器中使用面板，请参考[搭建面板](../dashboard)

## 开机自启

### Linux

待补充

### Windows

#### 在登录帐户时自动启动

在 Windows 系统中按下 `Win+R` 打开运行对话框，输入 `shell:startup` 并回车运行，将打开文件夹`C:\Users\你的用户名\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup`。该文件夹中包含会在帐户登录时要启动的程序的快捷方式。要想将你的服务端在服务器登录帐户进入桌面时启动，需要按照以下步骤操作：

1. 为服务器的可执行文件创建快捷方式。右键该文件，然后选择创建快捷方式（Windows 11 及以上版本需要先选择“显示更多选项”才能显示该选项），即可在该可执行文件的同级目录创建一个它的快捷方式。
2. 将此快捷方式直接移动至上述文件夹。

该启动方式有个缺点，如果服务器有开机密码，服务器开机时将不会自动登录至服务器，你仍然需要在服务器开机后，在服务器上输入密码或使用 rdp 连接一次服务器才能使帐户登录，进而触发开机自启。你必须同时[为系统配置自动登录](#系统启动时自动登录)，否则并不能完全实现服务器开机后自动启动服务端。

#### 在系统启动时自动启动（无需登录）

1. `Win+R` 打开运行窗口，输入 `taskschd.msc` 回车，打开任务计划程序。
2. 点击进入侧边栏的**任务计划程序库**
3. 点击右侧操作一栏的**创建任务**
   1. 常规
      1. 名称：是你给这个开机自启计划起的名字，写什么不影响最后的执行结果
      2. 下方安全选项中，点击**不管用户是否登录都要运行**。如果你不清楚这个进程至少需要什么权限，勾上“使用最高权限运行”。
      3. 配置尽可能选择跟当前操作系统名一样的，比如 Windows 10 系统就选 **Windows 10**
         
    2. 触发器
        1. 点击**新建**
        2. 开始任务选择**启动时**
        3. 点击**确定**
    3. 操作
        1. 点击**新建**
        2. 操作选择**启动程序**
        3. 程序或脚本下，点击右侧的**浏览**，选择你要开机自启的可执行或批处理文件，也可以手动把文件的路径粘贴进去
        4. 把上面文件的路径后面的文件名去掉，填进下面的起始路径，比如文件路径是 `C:\Users\Administrator\Documents\frpc\frpc.bat`，起始路径就是 `C:\Users\Administrator\Documents\frpc\`。这里他虽然说可选但是必须得填
        5. 点击**确定**
    4. 条件
        1. 电源标题下，去掉**计算机使用交流电源时才启动此任务**的勾
        2. 勾上**唤醒计算机运行此任务**
        3. 点击**确定**
    5. 设置
        1. 勾上**如果过了计划开始时间，立即启动新任务**、**如果任务失败，按以下频率重新启动：**，
        2. 去掉**如果任务运行时间超过以下时间，停止任务：** 的勾
        3. 点击**确定**
    6. 点击**确定**，输入服务器密码

此时上方的列表中应该就有你创建的任务了。这样创建的开机自启会在启动后静默运行，不会显示在你的桌面上。

:::tip

这种方法还可以防止登出时它开机启动的进程被杀死，导致一些重要的进程如用于远程桌面的代理关闭造成服务器失联

:::

#### 系统启动时自动登录

对于 Windows Server 2022 和 Windows 10 22H2 及更高版本的 Windows 系统，需要选进行以下操作：

1. `Win+R` 打开运行窗口，输入 `regedit` 回车，打开注册表。
2. 前往 `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\PasswordLess\Device`
3. 修改注册表项 `DevicePasswordLessBuildVersion` 值为 `0`

对于所有版本的 Windows，继续以下操作：

1. `Win+R` 打开运行窗口，输入 `netplwiz` 回车，打开用户帐户。
2. 去掉**要使用本计算机，用户必须输入用户名和密码**复选框的勾
3. 点击确定
4. 输入你的用户名，然后输入密码，在重复密码处再输入一次密码，随后点击确定

#### 注册为系统服务

待补充

## 来电开机

:::info

此段落是为自行维护物理机（家里云）的服主写的。

:::

来电开机需要在主板的 BIOS 中设置。不同的品牌和型号的设置方式和行为存在较大差异，但绝大多数主板都能实现来电开机行为。由于主板固件种类繁多，更新换代快，故不在此处提供来电开机的具体设置方法，读者可使用搜索引擎搜索相关教程。